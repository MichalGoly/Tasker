<?php
session_start();
//session_save_path("/users/tho4/public_html/CS25010/sessions"); 
error_reporting (E_ALL ^ E_NOTICE);	
$username=$_SESSION['name'];	

if(!isset($username))
{
header("Location: login.php");
}else{
	
echo "Welcme to the TaskerMAN " . $username;	
	
}
	

?>
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta content="IE=edge" http-equiv="X-UA-Compatible">
  <meta content="width=device-width, initial-scale=1" name="viewport">
  <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
  <meta content="" name="description">
  <meta content="" name="author">
  <link href="../../favicon.ico" rel="icon">
  <title>TaskerMAN</title>
  <!-- Bootstrap core CSS -->
  <link href="css/bootstrap.min.css" rel="stylesheet">
  
  <!-- Custom styles for this template -->
  <link href="jumbotron.css" rel="stylesheet">
  

  <script src="../../assets/js/ie-emulation-modes-warning.js">
  </script>
  
  <title>TaskerMAN</title>
</head>
<body>
  <div>
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
        
        <!-- navbar CSS -->
          <button aria-controls="navbar" aria-expanded="false" class=
          "navbar-toggle collapsed" data-target="#navbar" data-toggle=
          "collapse" type="button"><span class="sr-only">Toggle
          navigation</span> <span class="icon-bar"></span> <span class=
          "icon-bar"></span> <span class="icon-bar"></span></button> <a class=
          "navbar-brand" href="http://users.aber.ac.uk/tig/taskerMAN">TaskerMAN</a>
        </div>
        <div class="navbar-collapse collapse" id="navbar">
          <ul class="nav navbar-nav navbar-right">
            <li>
               <a href="#">
                <img src="img/logout.png"/>
            </a> 
            </li>
          </ul>
        </div>
      </div>
    </nav>
    
    <div class="containerCentre">
    <div class="container">
      <br>
      <br>
      <br>
      <!-- CSS div classes --> 
	  <h1 class="page-header"></h1>
      <div class="jumbotron">
        <ol class="breadcrumb">
          <li>
            <a href="index.php">Home</a>
          </li>
          
          <!-- Inserts data from add task webpage into DB -->
          
        </ol><?php
                  
                  include 'connector.php';


                  require_once("classes/tc_calendar.php");




                $required = array('title','sDate','eDate','mEmail');
                $error = false;
                foreach($required as $field) {
                  if (empty($_POST[$field])) {
                    $error = true;
                  }
                }

                if ($error) {
                  echo "All fields are required.";
                } else {
                    $setStatusTo1 = 1; //allocated
                  //echo $setStatusTo1 ;

                            
                }   



                $task = "INSERT INTO Task (title, startDate, endDate, taskStatus,TeamMember_email)
                        VALUES ('$_POST[title]','$_POST[sDate]','$_POST[eDate]','$setStatusTo1','$_POST[mEmail]'
                        )";


                if($connection->query($task)===TRUE){
                    
                        
                        
                        $array = $_POST['tDescription'];

                            foreach($array as $value){
                                    $element = "INSERT INTO TaskElement (description, Task_taskId)
                                                VALUES ('$value',(SELECT taskId FROM Task WHERE title = '$_POST[title]'))";
                                    
                            
                                if($connection->query($element)===TRUE){
                                    echo "<div class='alert alert-success'>.";
                                    echo "<strong><img src='img/AddTask.png'> <BR><BR>SUCCESSFULLY ADDED ";
                                    echo "<BR><BR><BR><a href='AddTaskBoot.php'>ADD ANOTHER TASK</a>";
                                    echo "</strong>";
                                    echo "</div>";
                                }
                            }
                }else{
                        echo "<div class='alert alert-danger'>.";
                        echo " <strong><img src='img/warninguser.png'> <BR><BR>ERROR - $connection->error.";
                        echo "<BR><BR><BR><a href='AddTaskBoot.php'>TRY AGAIN</a>";
                        echo "</strong>";
                        echo "</div>";
                }

                    
                $connection->close();                       
                ?>
      </div>
    </div>
  </div>
</body>
</html>